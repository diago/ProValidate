var ProValidate=(function(){var a=Class.create();a.Version="0.4.1";a.options={submitOnValid:true,errorClass:"invalid",errorMessageClass:"errorMessage",errorTemplate:'<span class="#{elementId} #{errorMessageClass}">#{message}</span>',checkStore:true,invalidFormClass:"invalidForm",cannedMessages:{required:"Required",phone:"Invalid phone number",email:"Invalid email",alpha:"Letters only",alpah_numeric:"Numbers and letters only",numeric:"Invalid number",date:"Invalid date",digit:"Numbers only",price:"Invalid price"},defaultInvalidMessage:"Invalid",onStart:Prototype.emptyFunction,onInvalid:function(){return true},onValid:Prototype.emptyFunction,onFormValid:Prototype.emptyFunction};a.prototype={initialize:function(d,b){this.options=Object.extend(a.options,b||{});this.form=$(d);this.elements=$H();this.errorTemplate=new Template(this.options.errorTemplate);this.cannedMessages=$H(this.options.cannedMessages);this._storedRulesAdded=false;this.form.observe("submit",this._validate.bindAsEventListener(this));this.options.onStart(this);var c=$$("."+this.options.errorClass);if(c.length>0){c.first().select()}},validate:function(e,j){var e=this._realElement(e);var c=e.identify();var d=false;var g,h,f;if(Object.isString(j)){var b=this.elements.get(c);allRules=$H();allRules.set(j,b.get(j))}else{if(Object.isUndefined(j)){allRules=this.elements.get(c)}else{allRules=$H(j)}}allRules.each(function(k){g=k.key;h=k.value;if(!(d=this._test(e,g))){this.trigger(e,g,h);throw $break}}.bind(this));this.options.onValid(e,this);return d},trigger:function(b,c,d){var b=this._realElement(b);b.addClassName(this.options.errorClass);fillTemp={elementId:b.identify(),errorMessageClass:this.options.errorMessageClass,message:d||this._findErrorMessage(b,c)};if(this.options.onInvalid(b,c,d,this)===true){b.insert({after:this.errorTemplate.evaluate(fillTemp)})}this.form.addClassName(this.options.invalidFormClass);return this},addRule:function(c,d,b){var c=this._realElement(c);var e;var b=b||this._findErrorMessage(c,d);if(e=this.elements.get(c.identify())){e.set(d,b)}else{var e=$H();e.set(d,b);this.elements.set(c.identify(),e)}return this},addRules:function(c,d){if(Object.isArray(d)||typeof d!=="object"){throw ("rules must be an object {}")}var b;for(b in d){this.addRule(c,b,d[b])}return this},removeRule:function(c,d){var c=this._realElement(c);var b=c.identify();var e=this.elements.get(b);e.unset(d);this.elements.set(b,e);return this},add:function(b){this._current=b;return this},rule:function(c,b){this.addRule(this._current,c,b||false);return this},storedRules:function(b){var c;if(c=$(b).retrieve("provalidate")){this.addRules(b,c);$(b).store("provalidate",null)}return this},clearInvalid:function(b){if(b){var b=this._realElement(b);b.removeClassName(this.options.errorClass);$$("."+b.identify()).invoke("remove")}else{$$("."+this.options.errorMessageClass).invoke("remove");$$("."+this.options.errorClass).invoke("removeClassName",this.options.errorClass);this.form.removeClassName(this.options.invalidFormClass)}return this},_validate:function(c){if(!this._storedRulesAdded&&this.options.checkStore){this.form.getElements().each(function(e){this.storedRules(e)}.bind(this));this._storedRulesAdded=true}var b=c.element();var d;this.clearInvalid();this.elements.each(function(e){b=e.key;rules=e.value;this.validate(b,rules)}.bind(this));d=$$("."+this.options.errorClass);if(d.length>0){c.stop();d.first().select()}else{if(!this.options.submitOnValid){c.stop()}this.options.onFormValid(this)}},_test:function(c,e){var c=$(c);var e=this._ruleAndParams(e);if(Object.isArray(e)){var b=e[0];var d=e[1];if(Object.isFunction(a.Validation[b])){return a.Validation[b](c,d)}}else{if(Object.isFunction(a.Validation[e])){return a.Validation[e](c)}}return true},_addRules:function(b,c){var b=$(b).identify();for(i=0;i<c.length;i++){this.addRule(b,c[i])}},_findErrorMessage:function(b,c){return this.cannedMessages.get(c.match(/[\w]+/).first())||this.options.defaultInvalidMessage},_realElement:function(b){return $(b)||$$("#"+this.form.identify()+' [name="'+b+'"]').first()},_ruleAndParams:function(c){var b=c.match(/(\w.*)\[(.*)\]/);return(b===null)?c:[b[1],b[2]]}};a.Validation={datePattern:"\\d{1,2}\\/\\d{1,2}\\/\\d{4}",required:function(b){var c=$F(b);return !c.empty()},length:function(f,j){var e;var g=$F(f);var c=false;var h;if(g.empty()){return true}if(!Object.isString(g)){return false}e=g.length;h=j.split(",");if(h.length>1){var d=h[0]*1;var b=h[1]*1;if(e>=d&&e<=b){c=true}}else{c=(e===(j*1))}return c},matches:function(c,f){var e=$F(c);var d=false;var b=$$('[name="'+f+'"]').first()||$(f);if(b){d=(e===$F(b))}return e.empty()?true:d},alpha:function(b){var c=$F(b);return c.empty()?true:/^[a-zA-Z]*$/.test(c)},alpha_numeric:function(b){var c=$F(b);return c.empty()?true:/^[a-zA-Z0-9]*$/.test(c)},digit:function(b){var c=$F(b);return/^\d*$/.test(c)},numeric:function(b,d){var c=$F(b);var f=d||".";var e=new RegExp("^-?[0-9]*\\"+f+"?[0-9]*$");return c.empty()?true:e.test(c)},email:function(b){var c=$F(b);return c.empty()?true:/^[a-zA-Z][\w\.-]*[a-zA-Z0-9]@[a-zA-Z][\w\.-]*[a-zA-Z0-9]\.[a-zA-Z][a-zA-Z\.]*[a-zA-Z]$/.test($F(b))},phone:function(d,f){var e=$F(d);var c;var b=e.gsub(/\D/,"");if(Object.isUndefined(f)){c=[7,10,11]}else{c=f.split(",").map(function(g){return parseInt(g,10)})}return e.empty()?true:((c.indexOf(b.length)===-1)?false:true)},date:function(b,d){var c=$F(b);var e=new RegExp(d||a.Validation.datePattern);return c.empty()?true:e.test(c)},price:function(b){var c=$F(b);return c.empty()?true:/^\$?(\d{1,3}\,?\d{3}|\d{1})*(\.?\d{2})?$/.test(c)}};return a})();